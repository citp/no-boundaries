<!doctype html>
<html>
  <head>
    <title>Test page for JS Instrument's instrumentObject method</title>
  </head>
  <body>
    <h3>Test page for JS Instrument's instrumentObject method</h3>
    <p> This page defines several types of objects and tests the js
    instrument's instrumentObject() method. <br/>
    NOTE: The platform config option `manager_params['testing']` must be set
    to True otherwise the instrumentObject method won't be exposed to this
    test script.
    </p>
    <script type="text/javascript">
      function interactWithObjects() {
        // get and set prop1 (data property 1)
        console.log("prop1 before set",window.test.prop1);
        window.test.prop1 = 'blah1';
        console.log("prop1 after set",window.test.prop1);

        // get and set prop2 (data property 2)
        console.log("prop2 before set",window.test.prop2);
        window.test.prop2 = 'blah2';
        console.log("prop2 after set",window.test.prop2);

        // get and set objProp (data property)
        console.log("objProp before set",window.test.objProp);
        window.test.objProp = {'key': 'value'};
        console.log("objProp after set",window.test.objProp);

        // get and set prop3 (accessor property)
        console.log("prop3 before set",window.test.prop3);
        window.test.prop3 = 'blah3';
        console.log("prop3 after set",window.test.prop3);

        // call object method
        window.test.method1('hello', {'world': true});

        // overwrite a method and call
        window.test.method1 = function(arg) {console.log("new method1", arg);};
        window.test.method1('new argument');

        // overwrite a property with a function and call
        window.test.prop1 = function(arg) {console.log("prop now method", arg);};
        window.test.prop1('now accepting arugments');

        // overwrite a function with property
        window.test.method1 = 'now static';
        console.log("method turned static",window.test.method1);
      }

      // Build test object
      window.test = {};

      // create a method
      test.method1 = function(arg1, arg2) {
        console.log('method1', arg1, arg2);
      };

      // create data property
      test.prop1 = 'prop1';

      // create an object data property
      test.objProp = {'hello': 'world'};

      // create data property with defineProperty
      Object.defineProperty(test, 'prop2', {
        value: 'prop2',
        enumerable: true,
        configurable: true,
        writable: true
      });

      // create accessor property
      var valueHolder = "default-value";
      Object.defineProperty(test, 'prop3', {
        get: function() { return valueHolder; },
        set: function(newValue) { valueHolder = newValue; },
        enumerable: true,
        configurable: true
      });

      // Instrument object
      console.log("Instrumenting window.test!");
      window.instrumentObject(window.test, "window.test");

      interactWithObjects();
    </script>
  </body>
</html>
